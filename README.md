
This is full of ugly hacks and localisms. But, feel free to use, and/or improve.
