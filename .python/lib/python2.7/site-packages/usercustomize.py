import traceback
import sys
from pprint import pprint, pformat

try:
    import pudb as debugger
except ImportError:
    import pdb as debugger

from pdb import bdb

def drop_debugger(type, value, tb):
    if type in (KeyboardInterrupt, bdb.BdbQuit):
        sys.__excepthook__(type, value, tb)
        return
    if sys.stderr.isatty():
        traceback.print_exception(type, value, tb)
        debug = raw_input('Debug? [Y/n]: ')
        if debug == '':
            debug = 'y'
        debug = debug.lower()[0]
        if debug == 'y':
            debugger.pm()
    else:
        sys.__excepthook__(type, value, tb)

sys.excepthook = drop_debugger

__builtins__['pp'] = pprint
__builtins__['pf'] = pformat
__builtins__['debugger'] = debugger
__builtins__['st'] = debugger.set_trace
